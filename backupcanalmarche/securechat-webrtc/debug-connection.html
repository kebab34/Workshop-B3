<!DOCTYPE html>
<html>
<head>
    <title>Debug Connection SecureChat</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #1e1e1e; color: #fff; }
        .test { margin: 10px 0; padding: 10px; border: 1px solid #333; background: #2d2d2d; }
        .success { border-color: green; background: #002000; }
        .error { border-color: red; background: #200000; }
        button { padding: 10px; margin: 5px; }
    </style>
</head>
<body>
    <h1>üîç Debug SecureChat Connection</h1>
    
    <div id="results"></div>
    
    <button onclick="testServer()">Test Serveur</button>
    <button onclick="testNetworkScan()">Scan R√©seau</button>
    <button onclick="openApp()">Ouvrir App</button>

    <script>
        const results = document.getElementById('results');
        
        function addResult(test, success, message, data = null) {
            const div = document.createElement('div');
            div.className = `test ${success ? 'success' : 'error'}`;
            div.innerHTML = `
                <strong>${test}</strong>: ${success ? '‚úÖ' : '‚ùå'} ${message}
                ${data ? `<pre>${JSON.stringify(data, null, 2)}</pre>` : ''}
            `;
            results.appendChild(div);
        }
        
        async function testServer() {
            try {
                // Test serveur local
                const response = await fetch('http://172.20.10.6:3001/health');
                const data = await response.json();
                addResult('Serveur Local', true, 'Serveur accessible', data);
                
                // Test serveur ami
                try {
                    const response2 = await fetch('http://172.20.10.3:3001/health');
                    const data2 = await response2.json();
                    addResult('Serveur Ami', true, 'Serveur ami accessible', data2);
                } catch (err) {
                    addResult('Serveur Ami', false, 'Serveur ami non accessible: ' + err.message);
                }
                
            } catch (err) {
                addResult('Serveur Local', false, 'Erreur: ' + err.message);
            }
        }
        
        async function testNetworkScan() {
            addResult('Scan R√©seau', true, 'Scanning 172.20.10.x...');
            
            const promises = [];
            for (let i = 1; i <= 10; i++) {
                const ip = `172.20.10.${i}`;
                promises.push(
                    fetch(`http://${ip}:3001/health`, { 
                        signal: AbortSignal.timeout(2000) 
                    })
                    .then(r => r.json())
                    .then(data => ({ ip, status: 'OK', data }))
                    .catch(() => ({ ip, status: 'FAIL' }))
                );
            }
            
            const results = await Promise.all(promises);
            const activeServers = results.filter(r => r.status === 'OK');
            
            addResult('Serveurs Actifs', true, `${activeServers.length} serveurs trouv√©s`, activeServers);
        }
        
        function openApp() {
            window.open('http://localhost:3000', '_blank');
        }
        
        // Test automatique au chargement
        window.onload = () => {
            setTimeout(testServer, 1000);
        };
    </script>
</body>
</html>